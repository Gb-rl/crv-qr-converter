<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <!-- iPad web app friendliness -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="format-detection" content="telephone=no" />
  <!-- Prevent indexing by search engines -->
  <meta name="robots" content="noindex,nofollow" />
  <title> Gift Card Tool</title>
  <style>
    :root { --gap: 16px; --c-bg: #d1d1d1; --c-accent: #fee906; --c-text: #111; }
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    body { display: grid; place-items: center; background: var(--c-bg); color: var(--c-text); }
    .card { width: min(920px, 94vw); padding: 24px; border-radius: 20px; background: #fff; box-shadow: 0 6px 30px rgba(0,0,0,.25); }
    .header { font-size: 1.6rem; font-weight: bold; margin-bottom: 12px; color: var(--c-text); }
    .description { font-size: 0.95rem; color: #333; margin-bottom: 16px; line-height: 1.4; }
    .row { display: flex; gap: var(--gap); flex-wrap: wrap; align-items: center; }
    .row > * { flex: 1 1 auto; }
    input[type="text"] { flex: 1; padding: 14px 16px; border-radius: 12px; border: 2px solid var(--c-accent); background: #fff; color: var(--c-text); font-size: 18px; }
    input[type="text"]::placeholder { color: #777; }
    button { padding: 14px 18px; border-radius: 12px; border: none; background: var(--c-accent); color: #000; font-size: 16px; font-weight: bold; cursor: pointer; transition: background .2s; }
    button:hover { background: #f0d800; }
    .qr-wrap { margin-top: 20px; display: grid; place-items: center; padding: 16px; background:#fafafa; border: 2px dashed var(--c-accent); border-radius: 16px; }
    #qrcode canvas, #qrcode img { width: min(78vw, 560px) !important; height: auto !important; image-rendering: pixelated; }
    .hint { font-size: 13px; color: #555; margin-top: 8px; }
    .error { color: #c00; margin-top: 8px; font-size: 14px; }
  </style>
</head>
<body>
  <div class="card" id="mainCard">
    <div class="header"> Gift Card Tool</div>
    <div class="description">
      Enter the <strong>alphanumerical code</strong> displayed on the GiftPro voucher, then scan the QR generated by this tool with the Toast device.<br>
      The code will <strong>disappear after 2 minutes</strong>, so have the Toast device ready to scan.
    </div>
    <div class="row" style="margin-bottom:12px">
      <input id="code" type="text" placeholder="Enter code" autofocus autocapitalize="none" autocorrect="off" spellcheck="false" inputmode="text" enterkeyhint="done" />
      <button id="gen">Generate QR</button>
    </div>
    <div class="hint">Only letters and numbers are accepted. No spaces or special characters.</div>
    <div id="err" class="error" hidden></div>
    <div id="qrContainer" class="qr-wrap">
      <div id="qrcode" aria-live="polite"></div>
    </div>
  </div>

  <!-- qrcode.js (MIT) from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

  <script>
    const input = document.getElementById('code');
    const btn = document.getElementById('gen');
    const err = document.getElementById('err');
    const qrel = document.getElementById('qrcode');
    let timeoutId;

    function resetPage(){
      input.value = '';
      qrel.innerHTML = '';
      err.hidden = true;
    }

    function renderQR(text){
      qrel.innerHTML = '';
      new QRCode(qrel, { text, width: 560, height: 560, correctLevel: QRCode.CorrectLevel.M });
      if(timeoutId){ clearTimeout(timeoutId); }
      timeoutId = setTimeout(()=>{ resetPage(); }, 120000); // 2 minutes
    }

    function handleGenerate(){
      const raw = input.value.trim();
      if(!raw){
        err.hidden = false; err.textContent = 'Please enter a code.';
        return;
      }
      if(!/^[A-Za-z0-9]+$/.test(raw)){
        err.hidden = false; err.textContent = 'Only letters and numbers are allowed. No spaces or special characters.';
        return;
      }
      err.hidden = true;
      renderQR(raw);
    }

    btn.addEventListener('click', handleGenerate);
    input.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ handleGenerate(); }});

    const params = new URLSearchParams(location.search);
    const fromQuery = params.get('code');
    if(fromQuery){
      if(/^[A-Za-z0-9]+$/.test(fromQuery)){
        input.value = fromQuery;
        handleGenerate();
      }
    }
  </script>
</body>
</html>
